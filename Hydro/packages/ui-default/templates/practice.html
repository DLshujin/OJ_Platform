<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¼–ç¨‹ç»ƒä¹ ç¯å¢ƒ</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { 
    height: 100%; 
    margin: 0; 
    padding: 0; 
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }
  .practice-container {
    height: 100vh;
    width: 100vw;
    display: flex;
    flex-direction: column;
    background: #1e1e1e;
    color: #d4d4d4;
    position: fixed;
    top: 0;
    left: 0;
    margin: 0;
    padding: 0;
  }
  
  .practice-header {
    background: #2d2d30;
    border-bottom: 1px solid #3e3e42;
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    min-height: 50px;
  }
  
  .practice-title {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 18px;
    font-weight: 600;
  }
  
  .practice-actions {
    display: flex;
    gap: 10px;
    align-items: center;
  }
  
  .practice-btn {
    background: #007acc;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.2s;
  }
  
  .practice-btn:hover {
    background: #106ba3;
  }
  
  .practice-btn.secondary {
    background: #5a5a5a;
  }
  
  .practice-btn.secondary:hover {
    background: #6a6a6a;
  }
  
  .practice-content {
    flex: 1;
    display: flex;
    overflow: hidden;
  }
  
  .practice-left {
    width: 60%;
    display: flex;
    flex-direction: column;
    border-right: 1px solid #3e3e42;
  }
  
  .practice-right {
    width: 40%;
    display: flex;
    flex-direction: column;
  }

  .input-section {
    height: 30%;
    border-bottom: 1px solid #3e3e42;
    display: flex;
    flex-direction: column;
  }

  .input-toolbar {
    background: #2d2d30;
    padding: 8px 15px;
    border-bottom: 1px solid #3e3e42;
    font-size: 12px;
    color: #cccccc;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .input-area {
    flex: 1;
    background: #1e1e1e;
    color: #d4d4d4;
    border: none;
    padding: 10px;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    resize: none;
    outline: none;
  }

  .input-area::placeholder {
    color: #666;
  }
  
  .problem-section {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    background: #252526;
  }
  
  .editor-section {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  
  .editor-toolbar {
    background: #2d2d30;
    padding: 8px 15px;
    border-bottom: 1px solid #3e3e42;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
  }
  
  .language-selector {
    background: #3c3c3c;
    color: #cccccc;
    border: 1px solid #464647;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
  }
  
  .editor-container {
    flex: 1;
    position: relative;
  }
  
  #editor {
    width: 100%;
    height: 100%;
    font-size: 14px;
  }
  
  .output-section {
    height: 70%;
    display: flex;
    flex-direction: column;
  }
  
  .output-toolbar {
    background: #2d2d30;
    padding: 8px 15px;
    border-bottom: 1px solid #3e3e42;
    font-size: 12px;
    color: #cccccc;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .output {
    flex: 1;
    background: #0c0c0c;
    color: #d4d4d4;
    font-family: 'Courier New', monospace;
    font-size: 16px;
    padding: 15px;
    margin: 0;
    overflow-y: auto;
    white-space: pre-wrap;
    line-height: 1.4;
  }
  
  .error-line {
    background: #ffebee !important;
    border-left: 4px solid #f44336;
    color: #c62828 !important;
  }
  
  .output-error {
    color: #ff6b6b;
    background: #2d1b1b;
    border-left: 4px solid #ff6b6b;
    padding: 10px;
    margin: 5px 0;
  }
  
  .output-success {
    color: #51cf66;
  }
  
  .problem-title {
    color: #569cd6;
    font-size: 24px;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid #3e3e42;
  }
  
  .problem-description {
    color: #d4d4d4;
    line-height: 1.6;
    margin-bottom: 20px;
  }
  
  .problem-section h3 {
    color: #4ec9b0;
    margin: 20px 0 10px 0;
    font-size: 18px;
  }
  
  .sample-case {
    background: #1e1e1e;
    border: 1px solid #3e3e42;
    border-radius: 4px;
    margin: 10px 0;
    overflow: hidden;
  }
  
  .sample-header {
    background: #2d2d30;
    padding: 8px 12px;
    font-size: 12px;
    color: #cccccc;
    font-weight: 600;
  }
  
  .sample-content {
    padding: 12px;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    color: #d4d4d4;
    white-space: pre-wrap;
  }
  
  .back-btn {
    background: #5a5a5a;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    text-decoration: none;
    transition: all 0.2s ease;
    font-size: 14px;
  }
  
  .back-btn:hover {
    background: #6a6a6a;
    color: white;
    text-decoration: none;
  }
</style>
</head>
<body>

<!-- Ace Editor -->
<script src="https://cdn.jsdelivr.net/npm/ace-builds@1.23.4/src-min-noconflict/ace.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ace-builds@1.23.4/src-min-noconflict/ext-language_tools.js"></script>

<div class="practice-container">
  <header class="practice-header">
    <div class="practice-title">
      <span>ğŸ’»</span>
      <span>åœ¨çº¿IDE</span>
      <span style="font-size: 12px; background: #28a745; padding: 4px 8px; border-radius: 12px;">çœŸå®åœ¨çº¿ç¼–è¯‘</span>
    </div>
    <div class="practice-actions">
      <a href="/" class="back-btn">â† è¿”å›é¦–é¡µ</a>
      <button class="practice-btn" onclick="submitCode()">ğŸš€ è¿è¡Œä»£ç </button>
    </div>
  </header>

  <div class="practice-content">
    <!-- ä»£ç ç¼–è¾‘å™¨åŒºåŸŸ -->
    <div class="practice-left">
      <div class="editor-section">
        <div class="editor-toolbar">
          <div>
            <label>ç¼–ç¨‹è¯­è¨€ï¼š</label>
            <select class="language-selector" id="languageSelect" onchange="changeLanguage()">
              <option value="cpp">C++</option>
              <option value="python">Python</option>
              <option value="java">Java</option>
              <option value="c">C</option>
              <option value="javascript">JavaScript</option>
            </select>
          </div>
          <div style="display: flex; align-items: center; gap: 15px;">
            <div style="color: #858585; font-size: 12px;">
              å­—ä½“å¤§å°ï¼š
              <button onclick="changeFontSize(-1)" style="background: #444; color: #ccc; border: 1px solid #666; padding: 2px 6px; margin: 0 2px; cursor: pointer;">A-</button>
              <button onclick="changeFontSize(1)" style="background: #444; color: #ccc; border: 1px solid #666; padding: 2px 6px; margin: 0 2px; cursor: pointer;">A+</button>
            </div>
            <div style="color: #858585; font-size: 12px;">
              Ctrl+R è¿è¡Œ | F11 å…¨å±
            </div>
          </div>
        </div>
        
        <div class="editor-container">
          <div id="editor">#include <iostream>
using namespace std;

int main() {
    cout << "Hello, World!" << endl;
    return 0;
}</div>
        </div>
      </div>
    </div>

    <!-- å³ä¾§ï¼šè¾“å‡ºå’Œè¾“å…¥åŒºåŸŸ -->
    <div class="practice-right">
      <!-- è¾“å…¥åŒºåŸŸ -->
      <div class="input-section">
        <div class="input-toolbar">
          <span>ğŸ“ ç¨‹åºè¾“å…¥</span>
          <button class="practice-btn secondary" onclick="clearInput()" style="font-size: 12px; padding: 4px 8px;">æ¸…ç©º</button>
        </div>
        <textarea class="input-area" id="inputArea" placeholder="åœ¨è¿™é‡Œè¾“å…¥ç¨‹åºéœ€è¦çš„æ•°æ®...&#10;æ¯è¡Œä¸€ä¸ªè¾“å…¥ï¼Œç¨‹åºè¿è¡Œæ—¶ä¼šæŒ‰è¡Œè¯»å–"></textarea>
      </div>

      <!-- è¾“å‡ºåŒºåŸŸ -->
      <div class="output-section">
        <div class="output-toolbar">
          <span>ğŸ–¥ï¸ è¿è¡Œç»“æœ</span>
          <button class="practice-btn secondary" onclick="clearOutput()" style="font-size: 12px; padding: 4px 8px;">æ¸…ç©º</button>
        </div>
        <div class="output" id="output">ğŸ’» åœ¨çº¿ç¼–è¯‘å™¨

æ”¯æŒè¯­è¨€ï¼šC++ã€Pythonã€Javaã€Cã€JavaScript
ç‚¹å‡»"è¿è¡Œä»£ç "æŒ‰é’®å¼€å§‹ç¼–ç¨‹ âœ¨</div>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  // åˆå§‹åŒ– Ace Editor
  var editor = ace.edit("editor");
  editor.setTheme("ace/theme/vs_dark");
  editor.session.setMode("ace/mode/c_cpp");
  editor.setOptions({
    enableBasicAutocompletion: true,
    enableSnippets: true,
    enableLiveAutocompletion: true,
    fontSize: 14,
    showPrintMargin: false,
    wrap: true
  });

  // è¯­è¨€é…ç½®
  var languages = {
    'cpp': {
      mode: 'ace/mode/c_cpp',
      template: '#include <iostream>\nusing namespace std;\n\nint main() {\n    cout << "Hello, World!" << endl;\n    return 0;\n}'
    },
    'python': {
      mode: 'ace/mode/python',
      template: 'print("Hello, World!")'
    },
    'java': {
      mode: 'ace/mode/java',
      template: 'public class Main {\n    public static void main(String[] args) {\n        System.out.println("Hello, World!");\n    }\n}'
    },
    'c': {
      mode: 'ace/mode/c_cpp',
      template: '#include <stdio.h>\n\nint main() {\n    printf("Hello, World!\\n");\n    return 0;\n}'
    },
    'javascript': {
      mode: 'ace/mode/javascript',
      template: 'console.log("Hello, World!");'
    }
  };

  // åˆ‡æ¢è¯­è¨€
  window.changeLanguage = function() {
    var select = document.getElementById('languageSelect');
    var lang = select.value;
    var config = languages[lang];
    
    if (config) {
      editor.session.setMode(config.mode);
      editor.setValue(config.template, -1);
    }
  };

  // å­—ä½“å¤§å°è°ƒèŠ‚
  var currentFontSize = 14;
  window.changeFontSize = function(delta) {
    currentFontSize += delta;
    if (currentFontSize < 10) currentFontSize = 10;
    if (currentFontSize > 24) currentFontSize = 24;
    
    editor.setFontSize(currentFontSize + 'px');
    document.getElementById('output').style.fontSize = (currentFontSize + 2) + 'px';
    document.getElementById('inputArea').style.fontSize = currentFontSize + 'px';
  };

  // è¿è¡Œä»£ç  - æœ¬åœ°æ¨¡æ‹Ÿç¼–è¯‘
  window.submitCode = function() {
    var code = editor.getValue();
    var lang = document.getElementById('languageSelect').value;
    var input = document.getElementById('inputArea').value;
    var output = document.getElementById('output');
    
    if (!code.trim()) {
      output.innerHTML = '<div class="output-error">âŒ é”™è¯¯ï¼šä»£ç ä¸èƒ½ä¸ºç©ºï¼</div>';
      return;
    }

    output.textContent = 'ğŸ”„ æ­£åœ¨ç¼–è¯‘è¿è¡Œ...\n';

    // æœ¬åœ°æ¨¡æ‹Ÿç¼–è¯‘
    localCompileAndRun(code, lang, output, input);
  };

  // è·å–è¯­è¨€åç§°
  function getLanguageName(lang) {
    var names = {
      'cpp': 'C++ (GCC 9.2.0)',
      'python': 'Python (3.8.1)',
      'java': 'Java (OpenJDK 13.0.1)',
      'c': 'C (GCC 9.2.0)',
      'javascript': 'JavaScript (Node.js 12.14.0)'
    };
    return names[lang] || lang.toUpperCase();
  }

  // è·å–Judge0è¯­è¨€ID
  function getLanguageId(lang) {
    var ids = {
      'cpp': 54,    // C++ (GCC 9.2.0)
      'python': 71, // Python (3.8.1)
      'java': 62,   // Java (OpenJDK 13.0.1)
      'c': 50,      // C (GCC 9.2.0)
      'javascript': 63 // JavaScript (Node.js 12.14.0)
    };
    return ids[lang] || 54;
  }

  // æœ¬åœ°æ¨¡æ‹Ÿç¼–è¯‘è¿è¡Œ - æ™ºèƒ½é”™è¯¯æ£€æµ‹
  function localCompileAndRun(code, lang, outputElement, input) {
    setTimeout(function() {
      var errors = checkSyntaxErrors(code, lang);
      
      if (errors.length > 0) {
        // æ˜¾ç¤ºç¼–è¯‘é”™è¯¯
        var errorHtml = '<div class="output-error">ç¼–è¯‘é”™è¯¯ï¼š\n\n';
        errors.forEach(function(error) {
          errorHtml += 'ç¬¬' + error.line + 'è¡Œ: ' + error.message + '\n';
          // é«˜äº®é”™è¯¯è¡Œ
          highlightErrorLine(error.line);
        });
        errorHtml += '</div>';
        outputElement.innerHTML = errorHtml;
      } else {
        // ç¼–è¯‘æˆåŠŸï¼Œæ¨¡æ‹Ÿè¿è¡Œ
        clearErrorHighlights();
        var result = simulateExecution(code, lang, input);
        outputElement.innerHTML = '<div class="output-success">' + result + '</div>';
      }
    }, 500);
  }

  // è¯­æ³•é”™è¯¯æ£€æŸ¥
  function checkSyntaxErrors(code, lang) {
    var errors = [];
    var lines = code.split('\n');
    
    if (lang === 'cpp' || lang === 'c') {
      // C/C++ è¯­æ³•æ£€æŸ¥
      var braceCount = 0;
      var parenthesisCount = 0;
      var hasMain = code.includes('main(');
      var hasInclude = code.includes('#include');
      
      if (!hasInclude) {
        errors.push({line: 1, message: 'ç¼ºå°‘å¤´æ–‡ä»¶ #include'});
      }
      
      if (!hasMain) {
        errors.push({line: 1, message: 'ç¼ºå°‘ main å‡½æ•°'});
      }
      
      for (var i = 0; i < lines.length; i++) {
        var line = lines[i].trim();
        var lineNum = i + 1;
        
        // æ£€æŸ¥å¤§æ‹¬å·åŒ¹é…
        for (var j = 0; j < line.length; j++) {
          if (line[j] === '{') braceCount++;
          if (line[j] === '}') braceCount--;
          if (line[j] === '(') parenthesisCount++;
          if (line[j] === ')') parenthesisCount--;
        }
        
        // æ£€æŸ¥åˆ†å·
        if (line.includes('cout') && !line.includes(';') && !line.includes('{')) {
          errors.push({line: lineNum, message: 'è¯­å¥æœ«å°¾ç¼ºå°‘åˆ†å· ;'});
        }
        
        // æ£€æŸ¥å¸¸è§æ‹¼å†™é”™è¯¯
        if (line.includes('cou<<') || line.includes('cout<')) {
          errors.push({line: lineNum, message: 'cout è¯­æ³•é”™è¯¯ï¼Œåº”è¯¥æ˜¯ cout <<'});
        }
      }
      
      if (braceCount !== 0) {
        errors.push({line: lines.length, message: 'å¤§æ‹¬å· {} ä¸åŒ¹é…'});
      }
      
      if (parenthesisCount !== 0) {
        errors.push({line: lines.length, message: 'å°æ‹¬å· () ä¸åŒ¹é…'});
      }
      
    } else if (lang === 'python') {
      // Python è¯­æ³•æ£€æŸ¥
      for (var i = 0; i < lines.length; i++) {
        var line = lines[i].trim();
        var lineNum = i + 1;
        
        // æ£€æŸ¥ç¼©è¿›é”™è¯¯ï¼ˆç®€å•æ£€æŸ¥ï¼‰
        if (line.startsWith('if ') && !line.endsWith(':')) {
          errors.push({line: lineNum, message: 'if è¯­å¥ç¼ºå°‘å†’å· :'});
        }
        
        if (line.startsWith('for ') && !line.endsWith(':')) {
          errors.push({line: lineNum, message: 'for è¯­å¥ç¼ºå°‘å†’å· :'});
        }
        
        // æ£€æŸ¥printè¯­æ³•
        if (line.includes('print ') && !line.includes('print(')) {
          errors.push({line: lineNum, message: 'Python 3 ä¸­ print å¿…é¡»ä½¿ç”¨æ‹¬å·'});
        }
      }
    }
    
    return errors;
  }

  // é«˜äº®é”™è¯¯è¡Œ
  function highlightErrorLine(lineNumber) {
    try {
      var session = editor.getSession();
      var Range = ace.require("ace/range").Range;
      var range = new Range(lineNumber - 1, 0, lineNumber - 1, Number.MAX_VALUE);
      var markerId = session.addMarker(range, "error-line", "fullLine");
      
      // ä¿å­˜æ ‡è®°IDä»¥ä¾¿åç»­æ¸…é™¤
      if (!window.errorMarkers) window.errorMarkers = [];
      window.errorMarkers.push(markerId);
    } catch (e) {
      console.log('Error highlighting line:', e);
    }
  }

  // æ¸…é™¤é”™è¯¯é«˜äº®
  function clearErrorHighlights() {
    try {
      if (window.errorMarkers) {
        var session = editor.getSession();
        window.errorMarkers.forEach(function(markerId) {
          session.removeMarker(markerId);
        });
        window.errorMarkers = [];
      }
    } catch (e) {
      console.log('Error clearing highlights:', e);
    }
  }

  // æ¨¡æ‹Ÿç¨‹åºæ‰§è¡Œ
  function simulateExecution(code, lang, input) {
    if (lang === 'cpp' || lang === 'c') {
      if (code.includes('cout') && code.includes('"Hello')) {
        return 'Hello, World!';
      } else if (code.includes('cout')) {
        return 'ç¨‹åºè¿è¡Œå®Œæˆ';
      }
    } else if (lang === 'python') {
      if (code.includes('print') && code.includes('Hello')) {
        return 'Hello, World!';
      } else if (code.includes('print')) {
        return 'ç¨‹åºè¿è¡Œå®Œæˆ';
      }
    }
    
    return 'ç¨‹åºè¿è¡Œå®Œæˆï¼Œæ— è¾“å‡º';
  }

  // åˆå§‹åŒ–ç¼–è¾‘å™¨å­—ä½“å¤§å°
  window.addEventListener('load', function() {
    if (typeof editor !== 'undefined') {
      editor.setFontSize(currentFontSize + 'px');
    }
  });

  // æ¸…ç©ºè¾“å‡º
  window.clearOutput = function() {
    document.getElementById('output').textContent = 'å‡†å¤‡è¿è¡Œ...';
    clearErrorHighlights();
  };

  // æ¸…ç©ºè¾“å…¥
  window.clearInput = function() {
    document.getElementById('inputArea').value = '';
  };

  // æ·»åŠ å¿«æ·é”®æ”¯æŒ
  document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.key === 'r') {
      e.preventDefault();
      submitCode();
    }
  });



  // æ–°é¢˜ç›®åŠŸèƒ½å·²ç§»é™¤

  // å¿«æ·é”®æ”¯æŒ
  document.addEventListener('keydown', function(e) {
    if (e.ctrlKey || e.metaKey) {
      if (e.key === 's') {
        e.preventDefault();
        // ä¿å­˜ä»£ç åˆ°æœ¬åœ°å­˜å‚¨
        localStorage.setItem('practice_code_' + document.getElementById('languageSelect').value, editor.getValue());
        document.getElementById('output').textContent = 'ğŸ’¾ ä»£ç å·²ä¿å­˜åˆ°æœ¬åœ°ï¼';
      } else if (e.key === 'r') {
        e.preventDefault();
        submitCode();
      }
    }
  });

  // é¡µé¢åŠ è½½æ—¶æ¢å¤ä¿å­˜çš„ä»£ç 
  window.addEventListener('load', function() {
    var lang = document.getElementById('languageSelect').value;
    var saved = localStorage.getItem('practice_code_' + lang);
    if (saved) {
      editor.setValue(saved, -1);
    }
  });
})();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ¨çº¿ä»£ç ç¼–è¾‘å™¨</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { 
    height: 100%; 
    margin: 0; 
    padding: 0; 
    overflow: hidden;
  }
  .ide-container {
    height: 100vh;
    width: 100vw;
    display: flex;
    flex-direction: column;
    background: #1e1e1e;
    color: #d4d4d4;
    position: fixed;
    top: 0;
    left: 0;
    margin: 0;
    padding: 0;
  }
  
  .topbar {
    background: #2d2d30;
    border-bottom: 1px solid #3e3e42;
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .tabs {
    display: flex;
    gap: 2px;
  }
  
  .tab {
    background: #3c3c3c;
    color: #cccccc;
    border: none;
    padding: 8px 16px;
    cursor: pointer;
    border-radius: 4px 4px 0 0;
    transition: all 0.2s ease;
  }
  
  .tab.active {
    background: #007acc;
    color: white;
  }
  
  .tab:hover:not(.active) {
    background: #4a4a4a;
  }
  
  .actions {
    display: flex;
    gap: 10px;
    align-items: center;
  }
  
  .btn {
    background: #0e639c;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    font-size: 14px;
    transition: all 0.2s ease;
  }
  
  .btn:hover {
    background: #1177bb;
    color: white;
    text-decoration: none;
  }
  
  .btn.run {
    background: #16a085;
  }
  
  .btn.run:hover {
    background: #1abc9c;
  }
  
  .workspace {
    flex: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1px;
    background: #3e3e42;
  }
  
  .editor-pane {
    background: #1e1e1e;
    display: flex;
    flex-direction: column;
  }
  
  #editor {
    flex: 1;
  }
  
  .stdin {
    background: #2d2d30;
    border-top: 1px solid #3e3e42;
    padding: 10px;
  }
  
  .stdin label {
    display: block;
    color: #cccccc;
    font-size: 12px;
    margin-bottom: 5px;
  }
  
  .stdin textarea {
    width: 100%;
    height: 80px;
    background: #1e1e1e;
    color: #d4d4d4;
    border: 1px solid #3e3e42;
    border-radius: 4px;
    padding: 8px;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    resize: vertical;
  }
  
  .output-pane {
    background: #0c0c0c;
    display: flex;
    flex-direction: column;
  }
  
  .output-toolbar {
    background: #2d2d30;
    padding: 8px 15px;
    border-bottom: 1px solid #3e3e42;
    font-size: 12px;
    color: #cccccc;
  }
  
  .output {
    flex: 1;
    background: #0c0c0c;
    color: #d4d4d4;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    padding: 15px;
    margin: 0;
    overflow-y: auto;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  .foot {
    background: #2d2d30;
    border-top: 1px solid #3e3e42;
    padding: 8px 20px;
    font-size: 12px;
    color: #888888;
  }
  
  .foot a {
    color: #007acc;
    text-decoration: none;
  }
  
  .foot a:hover {
    text-decoration: underline;
  }
  
  .back-btn {
    background: #5a5a5a;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    text-decoration: none;
    transition: all 0.2s ease;
  }
  
  .back-btn:hover {
    background: #6a6a6a;
    color: white;
    text-decoration: none;
  }
</style>
</head>
<body>

<!-- Ace Editor -->
<script src="https://cdn.jsdelivr.net/npm/ace-builds@1.23.4/src-min-noconflict/ace.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ace-builds@1.23.4/src-min-noconflict/ext-language_tools.js"></script>

<div class="ide-container">
  <header class="topbar">
    <div class="tabs">
      <button class="tab active" data-lang="python">ğŸ Python</button>
      <button class="tab" data-lang="cpp">âš¡ C++</button>
    </div>
    <div class="actions">
      <a href="/" class="back-btn">â† è¿”å›é¦–é¡µ</a>
      <button id="runBtn" class="btn run">â–¶ï¸ è¿è¡Œ (Ctrl+Enter)</button>
      <button id="clearBtn" class="btn">ğŸ—‘ï¸ æ¸…ç©ºè¾“å‡º</button>
      <a class="btn" target="_blank" rel="noopener" href="/scratch">ğŸ§© Scratch</a>
    </div>
  </header>

  <main class="workspace">
    <section class="editor-pane">
      <div id="editor"></div>
      <div class="stdin">
        <label>ğŸ“¥ æ ‡å‡†è¾“å…¥ï¼ˆå¯é€‰ï¼‰</label>
        <textarea id="stdin" placeholder="åœ¨æ­¤è¾“å…¥è¿è¡Œæ—¶çš„æ ‡å‡†è¾“å…¥...&#10;ä¾‹å¦‚ï¼š&#10;3 4&#10;"></textarea>
      </div>
    </section>
    <section class="output-pane">
      <div class="output-toolbar">
        <span id="status">âœ… å·²å°±ç»ª</span>
      </div>
      <pre id="output" class="output">æ¬¢è¿ä½¿ç”¨åœ¨çº¿ä»£ç ç¼–è¾‘å™¨ï¼

æ”¯æŒçš„è¯­è¨€ï¼š
â€¢ Pythonï¼šç”± Pyodide åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œ
â€¢ C++ï¼šä½¿ç”¨ Judge0 å…¬å…± APIï¼ˆéœ€è”ç½‘ï¼‰

å¿«æ·é”®ï¼š
â€¢ Ctrl+Enterï¼šè¿è¡Œä»£ç 
â€¢ Ctrl+/ï¼šæ³¨é‡Š/å–æ¶ˆæ³¨é‡Š
â€¢ Ctrl+Zï¼šæ’¤é”€
â€¢ Ctrl+Yï¼šé‡åš

å¼€å§‹ç¼–å†™ä½ çš„ä»£ç å§ï¼</pre>
    </section>
  </main>

  <footer class="foot">
    <small>
      ğŸ’¡ Python ç”± <a target="_blank" rel="noopener" href="https://pyodide.org/">Pyodide</a> åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œï¼›
      C++ ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/engineer-man/piston">Judge0</a> å…¬å…± APIï¼ˆéœ€è”ç½‘ï¼‰ã€‚
      å‚è€ƒï¼š<a target="_blank" rel="noopener" href="/scratch">Scratch å›¾å½¢åŒ–ç¼–ç¨‹</a>
    </small>
  </footer>
</div>

<!-- Pyodide (Python in WebAssembly) -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>

<script>
let editor;
let pyodide;
let currentLang = 'python';

const templates = {
  python: `# Python ç¤ºä¾‹ä»£ç 
print("Hello, Python!")

# è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ
a = int(input("è¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ•°: "))
b = int(input("è¯·è¾“å…¥ç¬¬äºŒä¸ªæ•°: "))
result = a + b
print(f"ç»“æœ: {a} + {b} = {result}")`,
  
  cpp: `// C++ ç¤ºä¾‹ä»£ç 
#include <iostream>
using namespace std;

int main() {
    cout << "Hello, C++!" << endl;
    
    // è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ
    int a, b;
    cout << "è¯·è¾“å…¥ä¸¤ä¸ªæ•°: ";
    cin >> a >> b;
    
    int result = a + b;
    cout << "ç»“æœ: " << a << " + " << b << " = " << result << endl;
    
    return 0;
}`
};

// åˆå§‹åŒ–ç¼–è¾‘å™¨
function initEditor() {
  editor = ace.edit('editor');
  editor.setTheme('ace/theme/vs_dark');
  editor.session.setMode('ace/mode/python');
  editor.setValue(templates.python, -1);
  
  // å¯ç”¨è‡ªåŠ¨è¡¥å…¨
  editor.setOptions({
    enableBasicAutocompletion: true,
    enableSnippets: true,
    enableLiveAutocompletion: true,
    fontSize: 14,
    showPrintMargin: false,
    wrap: true
  });
  
  // å¿«æ·é”®
  editor.commands.addCommand({
    name: 'runCode',
    bindKey: {win: 'Ctrl-Enter', mac: 'Cmd-Enter'},
    exec: runCode
  });
}

// åˆ‡æ¢è¯­è¨€
function switchLanguage(lang) {
  currentLang = lang;
  
  // æ›´æ–°æ ‡ç­¾æ ·å¼
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.toggle('active', tab.dataset.lang === lang);
  });
  
  // æ›´æ–°ç¼–è¾‘å™¨
  if (lang === 'python') {
    editor.session.setMode('ace/mode/python');
    editor.setValue(templates.python, -1);
  } else if (lang === 'cpp') {
    editor.session.setMode('ace/mode/c_cpp');
    editor.setValue(templates.cpp, -1);
  }
  
  clearOutput();
  updateStatus('å·²å°±ç»ª');
}

// æ›´æ–°çŠ¶æ€
function updateStatus(message) {
  document.getElementById('status').textContent = message;
}

// æ¸…ç©ºè¾“å‡º
function clearOutput() {
  document.getElementById('output').textContent = '';
}

// è¾“å‡ºå†…å®¹
function outputText(text, isError = false) {
  const output = document.getElementById('output');
  const span = document.createElement('span');
  span.textContent = text + '\n';
  if (isError) {
    span.style.color = '#f48771';
  }
  output.appendChild(span);
  output.scrollTop = output.scrollHeight;
}

// åˆå§‹åŒ– Python ç¯å¢ƒ
async function initPython() {
  if (!pyodide) {
    updateStatus('ğŸ”„ æ­£åœ¨åˆå§‹åŒ–Pythonç¯å¢ƒ...');
    try {
      pyodide = await loadPyodide();
      updateStatus('âœ… Pythonç¯å¢ƒå·²å°±ç»ª');
    } catch (error) {
      updateStatus('âŒ Pythonç¯å¢ƒåˆå§‹åŒ–å¤±è´¥');
      outputText('Pythonç¯å¢ƒåˆå§‹åŒ–å¤±è´¥: ' + error.message, true);
    }
  }
}

// è¿è¡Œ Python ä»£ç 
async function runPython() {
  if (!pyodide) {
    await initPython();
    if (!pyodide) return;
  }
  
  const code = editor.getValue();
  const stdin = document.getElementById('stdin').value;
  
  updateStatus('ğŸ”„ æ­£åœ¨æ‰§è¡ŒPythonä»£ç ...');
  
  try {
    // è®¾ç½®æ ‡å‡†è¾“å…¥
    if (stdin) {
      pyodide.globals.set('__stdin_data__', stdin.split('\n'));
      pyodide.globals.set('__stdin_index__', 0);
      
      // é‡å®šä¹‰ input å‡½æ•°
      pyodide.runPython(`
import builtins
def custom_input(prompt=''):
    if prompt:
        print(prompt, end='')
    if '__stdin_data__' in globals() and __stdin_index__ < len(__stdin_data__):
        line = __stdin_data__[__stdin_index__]
        globals()['__stdin_index__'] += 1
        print(line)
        return line
    return ''
builtins.input = custom_input
      `);
    }
    
    const result = pyodide.runPython(code);
    if (result !== undefined) {
      outputText('è¿”å›å€¼: ' + result);
    }
    updateStatus('âœ… æ‰§è¡Œå®Œæˆ');
  } catch (error) {
    outputText('æ‰§è¡Œé”™è¯¯: ' + error.message, true);
    updateStatus('âŒ æ‰§è¡Œé”™è¯¯');
  }
}

// è¿è¡Œ C++ ä»£ç 
async function runCpp() {
  const code = editor.getValue();
  const stdin = document.getElementById('stdin').value;
  
  updateStatus('ğŸ”„ æ­£åœ¨æ‰§è¡ŒC++ä»£ç ...');
  
  try {
    // å°è¯•ä½¿ç”¨ Piston API
    const response = await fetch('https://emkc.org/api/v2/piston/execute', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        language: 'cpp',
        version: '10.2.0',
        files: [{
          content: code
        }],
        stdin: stdin
      })
    });
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    const result = await response.json();
    
    if (result.run) {
      if (result.run.stdout) {
        outputText('è¾“å‡º:\n' + result.run.stdout);
      }
      if (result.run.stderr) {
        outputText('é”™è¯¯:\n' + result.run.stderr, true);
      }
      if (result.run.code !== 0) {
        outputText(`ç¨‹åºé€€å‡ºç : ${result.run.code}`, true);
      }
      updateStatus('âœ… æ‰§è¡Œå®Œæˆ');
    } else {
      throw new Error('æ‰§è¡Œå¤±è´¥');
    }
  } catch (error) {
    outputText('æ‰§è¡Œé”™è¯¯: ' + error.message, true);
    outputText('\nğŸ’¡ æç¤º: C++ä»£ç éœ€è¦ç½‘ç»œè¿æ¥åˆ°å…¬å…±ç¼–è¯‘æœåŠ¡', true);
    updateStatus('âŒ æ‰§è¡Œé”™è¯¯');
  }
}

// è¿è¡Œä»£ç 
async function runCode() {
  clearOutput();
  
  if (currentLang === 'python') {
    await runPython();
  } else if (currentLang === 'cpp') {
    await runCpp();
  }
}

// é¡µé¢åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
  initEditor();
  
  // æ ‡ç­¾åˆ‡æ¢äº‹ä»¶
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
      switchLanguage(tab.dataset.lang);
    });
  });
  
  // æŒ‰é’®äº‹ä»¶
  document.getElementById('runBtn').addEventListener('click', runCode);
  document.getElementById('clearBtn').addEventListener('click', clearOutput);
  
  // åˆå§‹åŒ– Python ç¯å¢ƒï¼ˆå»¶è¿ŸåŠ è½½ï¼‰
  setTimeout(initPython, 1000);
});
</script>
</body>
</html>
